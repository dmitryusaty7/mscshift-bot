# MSCShift Bot

Телеграм-бот для управления сменами и отчётами. Проект собирается по блокам. Текущая реализация покрывает точку входа (Блок 0): проверка существования бригадира и маршрутизация к регистрации или основной панели.

## Технологический стек
- Node.js (LTS)
- PostgreSQL
- Directus (только просмотр данных и файлов)
- node-telegram-bot-api

## Архитектурные принципы
- Модульность: один файл — одна ответственность
- Все тексты вынесены в единый модуль `src/messages`
- Подключение к БД и репозитории разделены
- Простые логгеры и middleware для будущего расширения

## Структура проекта
```
src/
  bot/
    index.js              // запуск и регистрация обработчиков
    handlers/
      start.handler.js    // логика /start (Блок 0)
    middlewares/
      session.js          // временное хранение состояния пользователя
    keyboards/
      common.keyboards.js // общие клавиатуры (заглушки)
  db/
    index.js              // создание пула PostgreSQL
    brigadiers.repo.js    // запросы к таблице brigadiers
  directus/               // клиент Directus для работы с файлами и сущностями
  messages/
    index.js              // все тексты бота
  config/
    env.js                // проверка окружения
  utils/
    logger.js             // простой логгер
  index.js               // точка входа
```

## Блоки
- **Блок 0** — реализован: команда `/start`, поиск бригадира в БД, маршрутизация к регистрации или основной панели (заглушки)
- **Блок 1** — TODO: сценарий регистрации
- **Блок 2** — TODO: основная панель бригадира
- **Загрузка фото** — реализовано: получение фото от пользователя, отправка в Directus `/files`,
  создание записи в `shift_photos` с привязкой к смене и пользователю

## Запуск
1. Скопировать пример окружения и заполнить переменные:
   - `TELEGRAM_BOT_TOKEN`
   - `PG_HOST`, `PG_PORT`, `PG_DATABASE`, `PG_USER`, `PG_PASSWORD`
   - `DIRECTUS_URL`, `DIRECTUS_STATIC_TOKEN`
   - (опционально) `DIRECTUS_USERS_COLLECTION`, `DIRECTUS_SHIFTS_COLLECTION`, `DIRECTUS_SHIFT_PHOTOS_COLLECTION`, `DIRECTUS_SHIFT_DEFAULT_STATUS`
2. Установить зависимости:
   ```bash
   npm install
   ```
3. Запустить бота:
   ```bash
   npm start
   ```

При старте бот проверяет подключение к PostgreSQL. Все сообщения пользователю отправляются на русском языке.
